{"version":3,"file":"index.js","sources":["../src/utils.ts","../src/Bifrost.ts","../src/useBifrost.tsx"],"sourcesContent":["const get = (obj, path, def) =>\n  (() =>\n    typeof path === 'string'\n      ? path.replace(/\\[(\\d+)]/g, '.$1')\n      : path.join('.'))()\n    .split('.')\n    .filter(Boolean)\n    .every((step) => (obj = obj[step]) !== undefined)\n    ? obj\n    : def\n\nexport { get }\n","import { RealmConfig } from './typings'\nimport { get } from './utils'\n\nclass Bifrost {\n  config: RealmConfig\n  bus: Element\n  realmList: string[]\n  language: string\n  locales: string[]\n  locale: string\n  state: any\n\n  constructor(config: RealmConfig) {\n    this.config = config\n    const { locales } = config\n    this.locales = Object.keys(locales)\n    this.bus = document.createElement('bifrost-bridge')\n    this.setLocale(this.locales[0])\n  }\n\n  setLocale(locale: string) {\n    if (this.config.locales[locale]) {\n      this.locale = locale\n    } else {\n      console.error('❗Bifrost Error❗ Locale not found 👉', locale)\n      // console.info('⚠️ Available locales 👉', this.locales)\n    }\n  }\n\n  openRealm(name: string, { state, props }) {\n    this.dispatchEvent('bifrost-open', { detail: { name, state, props } })\n  }\n\n  updateRealm(name: string, { props }) {\n    this.dispatchEvent('bifrost-update', { detail: { name, props } })\n  }\n\n  closeRealm(name: string) {\n    this.dispatchEvent('bifrost-close', { detail: { name } })\n  }\n\n  /**\n   * Add an event listener.\n   */\n  addEventListener(event, callback) {\n    this.bus.addEventListener(event, callback)\n  }\n\n  /**\n   * Remove an event listener.\n   */\n  removeEventListener(event, callback) {\n    this.bus.removeEventListener(event, callback)\n  }\n\n  /**\n   * Dispatch an event.\n   */\n  dispatchEvent(event, ...args) {\n    this.bus.dispatchEvent(new CustomEvent(event, ...args))\n  }\n\n  translate(key: string, scene?: string): string {\n    if (scene) {\n      return this.config.locales[this.locale][scene][key]\n    } else {\n      return get(this.config.locales[this.locale], key, key)\n    }\n  }\n}\n\nexport default Bifrost\n","import { useMemo } from 'react'\n\nimport { atom, useAtom } from 'jotai'\n\nimport Bifrost from './Bifrost'\nimport { RealmConfig } from './typings'\n\nconst realmStateAtom = atom({})\nconst realmPropsAtom = atom({})\n\nconst useBifrost = ({\n  config,\n  currentRealm\n}: {\n  config?: RealmConfig\n  currentRealm?: string\n}) => {\n  const realms = config?.realms ?? {}\n  const [realmsState, setRealmsState] = useAtom(realmStateAtom)\n  const [realmsProps, setRealmsProps] = useAtom(realmPropsAtom)\n\n  const openRealm = (realmName?: string) => {\n    const realm = realmName || currentRealm\n    if (realm) {\n      setRealmsState({\n        ...realmsState,\n        [realm]: {\n          ...(realmsState[realm] || {}),\n          open: true\n        }\n      })\n    } else {\n      console.error(\n        '❗Bifrost Error❗ openRealm failed 👉 currentRealm not set and realmName not passed'\n      )\n    }\n  }\n\n  const closeRealm = (realmName?: string) => {\n    const realm = realmName || currentRealm\n    if (realm) {\n      setRealmsState({\n        ...realmsState,\n        [realm]: {\n          ...(realmsState[realm] || {}),\n          open: false\n        }\n      })\n    } else {\n      console.error(\n        '❗Bifrost Error❗ closeRealm failed 👉 currentRealm not set and realmName not passed'\n      )\n    }\n  }\n\n  if (!window.Bifrost && config) {\n    window.Bifrost = new Bifrost(config)\n    window.Bifrost.bus.addEventListener('bifrost-open', ({ detail }: any) => {\n      const { name, state, props } = detail\n      if (state) {\n        setRealmsState({\n          ...realmsState,\n          [name]: state\n        })\n      }\n      if (props) {\n        setRealmsProps({\n          ...realmsProps,\n          [name]: props\n        })\n      }\n      openRealm(name)\n    })\n    window.Bifrost.bus.addEventListener('bifrost-close', ({ detail }: any) => {\n      const { name } = detail\n      closeRealm(name)\n    })\n\n    window.Bifrost.bus.addEventListener('bifrost-update', ({ detail }: any) => {\n      const { name, props } = detail\n      if (props) {\n        setRealmsProps({\n          ...realmsProps,\n          [name]: props\n        })\n      }\n    })\n  }\n\n  const currentRealmState = useMemo(\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    () => (currentRealm ? realmsState[currentRealm] : realmsState),\n    [realmsState]\n  )\n  const realmIsOpen = currentRealmState?.open ?? false\n  const realmList = Object.keys(realms)\n  const currentRealmProps = useMemo(\n    () => (currentRealm ? realmsProps[currentRealm] : realmsProps),\n    [realmsProps]\n  )\n\n  const t = (key: string) => {\n    return window.Bifrost.translate(key, currentRealm)\n  }\n\n  const BifrostContainer = ({ ...props }) => (\n    <div\n      style={{\n        position: 'absolute',\n        width: '100vw',\n        height: '100vh'\n      }}\n      {...props}\n    >\n      {realms}\n    </div>\n  )\n  return {\n    BifrostContainer,\n    realmList,\n    openRealm,\n    closeRealm,\n    state: currentRealm ? currentRealmState : realmsState,\n    props: currentRealm ? currentRealmProps : realmsProps,\n    setRealmsProps,\n    setRealmsState,\n    realmIsOpen,\n    t\n  }\n}\n\nexport default useBifrost\n"],"names":["get","obj","path","def","replace","join","split","filter","Boolean","every","step","undefined","Bifrost","config","locales","Object","keys","bus","document","createElement","setLocale","locale","console","error","openRealm","name","state","props","dispatchEvent","detail","updateRealm","closeRealm","addEventListener","event","callback","removeEventListener","args","CustomEvent","translate","key","scene","realmStateAtom","atom","realmPropsAtom","useBifrost","currentRealm","realms","useAtom","realmsState","setRealmsState","realmsProps","setRealmsProps","realmName","realm","open","window","currentRealmState","useMemo","realmIsOpen","realmList","currentRealmProps","t","BifrostContainer","position","width","height"],"mappings":"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"}